# üöÄ –§–∞–∑–∞ 1: –ó–∞–ø—É—Å–∫ Baseline Evaluation - Setup Guide

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É
**–í—Ä–µ–º—è:** 30-60 –º–∏–Ω—É—Ç
**–î–∞—Ç–∞:** 2025-12-16

---

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:
- ‚úÖ Python 3.11.14
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ ChromaDB –≥–æ—Ç–æ–≤–∞ (`chroma_db_gigachat/`, 35MB)
- ‚úÖ –î–∞—Ç–∞—Å–µ—Ç –≥–æ—Ç–æ–≤ (`tests/dataset.csv`, 16 –≤–æ–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Demo —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª

### –ß—Ç–æ –Ω—É–∂–Ω–æ:
- üîë API –∫–ª—é—á–∏ (GigaChat + OpenAI)
- ‚öôÔ∏è  –§–∞–π–ª `.env` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (–≤—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∫–ª—é—á–∏)
nano .env  # –∏–ª–∏ vim, code, etc.
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏:**
```env
# LLM Provider
LLM_PROVIDER=gigachat
GIGACHAT_CREDENTIALS=–≤–∞—à_–∫–ª—é—á_gigachat

# Embeddings
OPENAI_API_KEY=sk-proj-–≤–∞—à_–∫–ª—é—á_openai
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL_NAME=text-embedding-3-small
```

**–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏:**
- **GigaChat:** https://developers.sber.ru/studio/workspaces
- **OpenAI:** https://platform.openai.com/api-keys

---

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ .env –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
python -c "
from dotenv import load_dotenv
import os
load_dotenv()
print('‚úÖ GigaChat:', 'OK' if os.getenv('GIGACHAT_CREDENTIALS') else '‚ùå NOT SET')
print('‚úÖ OpenAI:', 'OK' if os.getenv('OPENAI_API_KEY') else '‚ùå NOT SET')
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
‚úÖ GigaChat: OK
‚úÖ OpenAI: OK
```

---

### –®–ê–ì 3: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (5 –≤–æ–ø—Ä–æ—Å–æ–≤)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å eval –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
python eval/run_full_evaluation.py --limit 5
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ChromaDB
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è LLM (GigaChat)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 5 –≤–æ–ø—Ä–æ—Å–æ–≤:
   - Retrieval –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
   - –û—Ü–µ–Ω–∫–∞ –º–µ—Ç—Ä–∏–∫ (6 evaluators)
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `benchmarks/results_history.jsonl`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç API)

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ (–ø—Ä–∏–º–µ—Ä):**
```
üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ RAG —Å–∏—Å—Ç–µ–º—ã...
üìÇ –î–∞—Ç–∞—Å–µ—Ç: tests/dataset.csv
üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ 5 –≤–æ–ø—Ä–æ—Å–æ–≤

üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...
‚úÖ LLM –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ Retriever –≥–æ—Ç–æ–≤

üìù –û—Ü–µ–Ω–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤...

[1/5] –ö—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—É—á–µ–Ω–∏–µ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ê?...
  ‚úÖ Correctness: 8.5/10
  üìä Faithfulness: 0.92
  ‚è±Ô∏è  –í—Ä–µ–º—è: 7.8s

[2/5] –ö–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤–∏–¥—ã –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π?...
  ‚úÖ Correctness: 9.0/10
  üìä Faithfulness: 0.95
  ‚è±Ô∏è  –í—Ä–µ–º—è: 6.5s

...

======================================================================
üìä –ò–¢–û–ì–û–í–´–ï –ú–ï–¢–†–ò–ö–ò
======================================================================

üéØ Correctness:
  –°—Ä–µ–¥–Ω–µ–µ:     8.2/10
  –ú–∏–Ω/–ú–∞–∫—Å:    7.5 / 9.0

‚úÖ Faithfulness:
  –°—Ä–µ–¥–Ω–µ–µ:     0.895

üîó Answer Relevance:
  –°—Ä–µ–¥–Ω–µ–µ:     0.870

üìö Citations:
  Citation rate:        95.0%
  –°—Ä–µ–¥–Ω–µ–µ –Ω–∞ –æ—Ç–≤–µ—Ç:     3.2

‚è±Ô∏è  Performance:
  –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:        7.5s
  P95 –≤—Ä–µ–º—è:            9.2s

üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ benchmarks/results_history.jsonl...
‚úÖ –ì–æ—Ç–æ–≤–æ!
```

---

### –®–ê–ì 4: –ü–æ–ª–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

–ï—Å–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ:

```bash
# –ü–æ–ª–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –≤—Å—ë–º –¥–∞—Ç–∞—Å–µ—Ç–µ
python eval/run_full_evaluation.py
```

**–í—Ä–µ–º—è:** ~15-30 –º–∏–Ω—É—Ç

---

### –®–ê–ì 5: –°–æ–∑–¥–∞–Ω–∏–µ baseline

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å baseline –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
python -c "
import json
from datetime import datetime

# –ß–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
with open('benchmarks/results_history.jsonl', 'r', encoding='utf-8') as f:
    lines = f.readlines()
    latest = json.loads(lines[-1])

# –°–æ–∑–¥–∞–µ–º baseline
baseline = {
    'date': latest['timestamp'],
    'version': 'v1.0.0',
    'dataset': latest['dataset'],
    'dataset_size': latest['dataset_size'],
    'config': {
        'llm_provider': 'gigachat',
        'embedding_provider': 'openai',
        'embedding_model': 'text-embedding-3-small',
        'chunk_size': 1200,
        'chunk_overlap': 150,
        'vector_search_k': 10,
        'hybrid_weights': [0.6, 0.4],
    },
    'metrics': latest['aggregate_metrics']
}

# –°–æ—Ö—Ä–∞–Ω—è–µ–º
with open('benchmarks/baseline.json', 'w', encoding='utf-8') as f:
    json.dump(baseline, f, indent=2, ensure_ascii=False)

print('‚úÖ Baseline —Å–æ–∑–¥–∞–Ω!')
print(f'üìä –ú–µ—Ç—Ä–∏–∫–∏:')
for key, value in baseline['metrics'].items():
    if 'mean' in key or 'p95' in key or 'rate' in key:
        print(f'  {key}: {value:.3f}')
"
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å baseline:**
```bash
cat benchmarks/baseline.json | jq '.metrics'
```

---

### –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª—è–º
python scripts/check_target_metrics.py
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
======================================================================
üéØ –ü–†–û–í–ï–†–ö–ê –¶–ï–õ–ï–í–´–• –ú–ï–¢–†–ò–ö
======================================================================

üìÖ Timestamp: 2025-12-16T21:30:00
üìä Dataset size: 16

üìà –°–≤–æ–¥–∫–∞:
   ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Ü–µ–ª–µ–≤—ã—Ö:  3/5
   ‚ö†Ô∏è  –ü—Ä–∏–µ–º–ª–µ–º–æ:          2/5
   ‚ùå –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö:          0/5

üéØ –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –ü–†–ò–ï–ú–õ–ï–ú–û

üìä –î–µ—Ç–∞–ª–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º:

‚úÖ Citation Rate
   –¢–µ–∫—É—â–µ–µ:  0.950
   –¶–µ–ª—å:     0.950
   –°—Ç–∞—Ç—É—Å:   –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ (>= 0.95)

‚ö†Ô∏è  Correctness score
   –¢–µ–∫—É—â–µ–µ:  7.800/10
   –¶–µ–ª—å:     8.000/10
   –°—Ç–∞—Ç—É—Å:   –ü—Ä–∏–µ–º–ª–µ–º–æ (>= 6.0, —Ü–µ–ª—å: 8.0)

...
```

---

### –®–ê–ì 7: –ö–æ–º–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –î–æ–±–∞–≤–∏—Ç—å baseline –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
git add benchmarks/baseline.json
git add benchmarks/results_history.jsonl
git add .env.example

git commit -m "Add initial baseline evaluation results

Evaluation completed:
- Dataset: golden-questions (16 questions)
- Correctness: 7.8/10
- Faithfulness: 0.89
- Answer Relevance: 0.87
- Citation Rate: 95%
- P95 Latency: 9.2s

Status: 3/5 targets achieved, 2/5 acceptable
Next: Expand dataset and optimize parameters
"

git push
```

---

## üéØ –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –¢–µ–∫—É—â–µ–µ |
|---------|---------|-----------|---------|
| Correctness | > 8.0/10 | < 6.0/10 | 7.8 ‚ö†Ô∏è |
| Faithfulness | > 0.90 | < 0.70 | 0.89 ‚ö†Ô∏è |
| Answer Relevance | > 0.85 | < 0.70 | 0.87 ‚úÖ |
| Citation Rate | > 0.95 | < 0.80 | 0.95 ‚úÖ |
| P95 Latency | < 10s | > 20s | 9.2s ‚úÖ |

---

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: ModuleNotFoundError

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –ü—Ä–æ–±–ª–µ–º–∞: ChromaDB not found

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ
ls -la chroma_db_gigachat/

# –ï—Å–ª–∏ –Ω–µ—Ç - –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å
python index.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: API Rate Limits

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–∏–π limit
python eval/run_full_evaluation.py --limit 3

# –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ (–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å eval/run_full_evaluation.py)
import time
time.sleep(1)  # –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ù–æ—Ä–º–∞–ª—å–Ω–æ:** 30-60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–æ–ø—Ä–æ—Å (6 evaluators √ó LLM calls)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--limit` –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã LLM (TODO: –¥–æ–±–∞–≤–∏—Ç—å)
- –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è evaluators (TODO: –¥–æ–±–∞–≤–∏—Ç—å)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –§–∞–∑—ã 1

- [x] Demo —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
- [x] .env.example —Å–æ–∑–¥–∞–Ω
- [x] ChromaDB –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π eval (5 –≤–æ–ø—Ä–æ—Å–æ–≤) –ø—Ä–æ—à–µ–ª
- [ ] –ü–æ–ª–Ω—ã–π eval (16 –≤–æ–ø—Ä–æ—Å–æ–≤) –∑–∞–≤–µ—Ä—à–µ–Ω
- [ ] baseline.json —Å–æ–∑–¥–∞–Ω
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–§–∞–∑–∞ 2)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 1:

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞:**
   ```bash
   python scripts/generate_questions.py
   ```

2. **–†—É—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤**

3. **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ**

4. **–§–∞–∑–∞ 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è CI/CD**

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **NEXT_STEPS.md** - –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω –≤—Å–µ—Ö —Ñ–∞–∑
- **QUICK_START.md** - –∫—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **eval/EXAMPLES.md** - 10 –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **DEVELOPMENT_PLAN.md** - –¥–µ—Ç–∞–ª—å–Ω—ã–π roadmap

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –í—ã–ø–æ–ª–Ω–∏—Ç–µ –®–ê–ì 1!** üöÄ
